<html>

<head>

	<!-- fonts -->
		<link href="https://fonts.googleapis.com/css?family=Barlow+Condensed" rel="stylesheet">
		
		<link rel="stylesheet" type="text/css" href="libraries/bootstrap-3.3.7/css/bootstrap.css">
		
		<!-- Awesome fonts -->
    	<link  rel="stylesheet" href="libraries/font-awesome-4.5.0/css/font-awesome.css">
    	
		<link rel="stylesheet" type="text/css" href="resources/css/sabine-poel.css">
		
		<script type="text/javascript" src="libraries/jquery-3.2.1/jquery.js"></script>
		<script type="text/javascript" src="libraries/bootstrap-3.3.7/js/bootstrap.js"></script>
		<script type="text/javascript" src="libraries/mustache-2.3.0/mustache.js"></script>
		
		<script type="text/javascript" src="resources/javascript/sabine.js"></script>
</head>

<body>

	<script id="sabine-person-template" type="text/template">
			<div class="person">
				<div class="form-group">
					<label for="organisation-name" class="col-sm-4 control-label">Voornaam en familienaam (*)</label>
					<div class="col-sm-3">	
						<input type="text" class="form-control input-name" required="required"></input>
					</div>
				</div>
				<div class="form-group">
						<label for="organisation-telefoon" class="col-sm-4 control-label">Telefoonnummer</label>
						<div class="col-sm-2">
							<input type="tel" class="form-control input-telephone"></input>
						</div>
				</div>
				<div class="form-group">
						<label for="organisation-email" class="col-sm-4 control-label">E-mail (*)</label>
						<div class="col-sm-3">
							<input type="email" class="form-control input-email" required="required" value=""></input>
						</div>
				</div>
				<br/>
			</div>
	</script>
	
	<header>
		<nav class="navbar sabine-navbar">
		  <a class="navbar-brand" href="#"></a>
		  <div class="navbar-collapse collapse" id="navbar-collapse">
		  	<ul class="nav navbar-nav navbar-right"> 
	  			<li class="nav-item sabine-nav-link"> <a href="index.html">Terug</a> </li>
	  		</ul>
  		</div>
		</nav>
	</header>

	<section id="sabine-afspraak" class="sabine-content-section">
	
		<article id="sabine-entry-form">
		
			<form id="entryForm" class="form-horizontal" role="form" method="post" enctype="application/x-www-form-urlencoded" accept-charset="utf-8">
		
				<p class="info">
					Velden met een (*) moet je zeker invullen.
				</p>
				
				<p class="info">
					Vul de gegevens in van alle personen die betrokken zijn bij de bemiddeling (minstens 2).
				</p>
				
				<p class="info">
					Na ontvangst van het formulier contacteer ik u zo snel mogelijk per e-mail.
				</p>
				
				<br/>
				
				<div id="sabine-persons">
				</div>
				
				<div class="form-group">
						<label for="organisation-email" class="col-sm-4 control-label"></label>
						<div class="col-sm-3">
							<button type="button" id="sabine-add-person" class="btn btn-primary"><i class="fa fa-plus"></i></button></button>
						</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-4 control-label">Verwerking gegevens (*)</label>
					<div class="col-sm-8">
						<input type="checkbox" required="required">&nbsp;Ik ben akkoord dat de gegevens van dit formulier verwerkt en gebruikt worden zoals aangegeven in de <a href="resources/files/privacy.pdf">privacy disclaimer</a>.
					</div>
				</div>
				 
				<div class="form-group">
					<label class="col-sm-4 control-label"></label>
					<div class="col-sm-8">
						<button type="submit" id="submit" class="btn btn-primary"><i class="fa fa-save"></i>&nbsp;&nbsp;Verstuur</button>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-4 control-label"></label>
					<div class="col-sm-8">
						<div id="submitStatus" class="hidden"></div>
					</div>
				</div>
				
			</form>
		
		</article>
		
		
	
	</section>
	

		
		<footer>
		<a class="footer-data" href="mailto:sabinepoel@gmail.com">sabinepoel@gmail.com</a>
		<a class="footer-data" href="tel:+32484767380">0484/76.73.80</a>
		<a class="footer-data" href="tel:+32484767380">Houwaartstraat 114, Linden</a>
	</footer>
			
</body>
	
	<script>
		var $jq = jQuery.noConflict();
		
		$jq("#sabine-home-more-link").click( function() {
	    	$jq(".sabine-not-home").removeClass("hidden");
	    	var root = $jq('html, body');
	    	var href = $jq.attr(this, 'href');
	        root.animate({
	            scrollTop: $jq(href).offset().top
	        }, 500, function () {
	            window.location.hash = href;
	        });
	        $jq("#sabine-home-more-button").addClass("hidden");
	        return false;
	    });
		
		$jq("#sabine-add-person").click( function() {
	    	
			addPerson();
			
	    });
		
		var addPerson = function() {
			
			var container = $jq("#sabine-persons");
			var template = $jq("#sabine-person-template").html();
			var html = Mustache.to_html(template);
			container.append( html );
			
	        return false;
			
		};
		
		var serialize = function( element ) {
		    var o = {};
		    var a = element.serializeArray();
		    $jq.each(a, function() {
		        if (o[this.name] !== undefined) {
		            if (!o[this.name].push) {
		                o[this.name] = [o[this.name]];
		            }
		            o[this.name].push(this.value || '');
		        } else {
		            o[this.name] = this.value || '';
		        }
		    });
		    return o;
		};
		
		var serializePersons = function( elements ) {
		    var o = new Array();
		    $jq.each(elements, function() {
		    	var name = $jq(this).find(".input-name").val();
		    	var email = $jq(this).find(".input-email").val();
		    	var telephone = $jq(this).find(".input-telephone").val();
		    	var person = new Person(name,email,telephone);
		       	o.push( person );
		    });
		    return o;
		};
		
		var Person = function (name,email,telephone) {
			this.name = name;
			this.email = email;
			this.telephone = telephone;
		};
		
		$jq("#entryForm").submit( function( event ) {
			
			event.preventDefault();
			
			var type = "json";

			var url = "${sabine-poel.backend}/api/entries";

			var fdata 
				= new FormData();
		
			var serializedForm
				= serialize( $jq("#entryForm") )
				
			var serializedPersons
				= serializePersons( $jq(".person") );
			
			serializedForm["persons"] = serializedPersons;

			var json 
				= JSON.stringify( serializedForm );
			
			busyButton($jq("#submit"));

			$jq.ajax({
				type : "post",
				url : url,
				dataType : type,
				contentType : "application/json",
				processData : false,
				data : json,
				success : function( created ) {
					success( $jq("#submit"), $jq("#submitStatus"), "Je aanvraag werd met succes verstuurd. U hoort snel iets van me." );
				},
				error : function( response ) {
					error($jq("#submit"), $jq("#submitStatus"), "Er trad een fout op. Probeer AUB opnieuw" );
				}
			});
			
		});
		
		$jq(document).ready(function($jq){
			
			addPerson();
			addPerson();
			
		    
	})
	</script>
	
</body>

</html>
